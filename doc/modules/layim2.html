 
 
<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8"utf-8">
<title>LayIM 2.x 开发者文档 - layui</title>
<meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="apple-mobile-web-app-status-bar-style" content="black"> 
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  
  <link rel="stylesheet" href="../../../layui/css/layui.css"   media="all">
  <link rel="stylesheet" href="../../../css/Global.css"  media="all">
  
</head>
<body>
<div class="layui-header header header-doc">
  <div class="layui-main">
    <a class="logo" href="../../index.htm">
      <img src="../../../res.layui.com/images/layui/logo.png" alt="layui">
    </a>
    <ul class="layui-nav">
      <li class="layui-nav-item layui-this">
        <a href="../index.htm" >文档</a>
      </li>
      <li class="layui-nav-item ">
        <a href="../../demo/index.htm">演示</a>
      </li>
      
      <li class="layui-nav-item">
        <a href="../../../fly.layui.com/index.htm"  target="_blank">社区</a>
      </li>
    </ul>
  </div>
</div>
<ul class="site-dir">
  <li><a href="#start"><cite>开始使用</cite></a></li>
  <li><a href="#config"><cite>初始化配置</cite></a></li>
  <li><a href="#init"><cite>init数据格式</cite></a></li>
  <li><a href="#members"><cite>获取群员数据格式</cite></a></li>
  <li><a href="#uploadImage"><cite>上传图片数据格式</cite></a></li>
  <li><a href="#uploadFile"><cite>上传文件数据格式</cite></a></li>
  <li><a href="#WebSocket"><cite>接入WebSocket</cite></a></li>
  <li><a href="#log"><cite>查看更多聊天记录</cite></a></li>
  <li><a href="#find"><cite>查找好友/群</cite></a></li>
  <li><a href="#on"><cite>事件监听</cite></a></li>
  <li><a href="#onready"><cite>ready事件</cite></a></li>
  <li><a href="#ononline"><cite>监听在线状态切换</cite></a></li>
  <li><a href="#onsendMessage"><cite>监听发送的消息</cite></a></li>
  <li><a href="#ongetMessage"><cite>监听接受的消息</cite></a></li>
  <li><a href="#onmembers"><cite>监听查看群员</cite></a></li>
  <li><a href="#onchatChange"><cite>监听聊天窗口切换</cite></a></li>
  <li><a href="#chat"><cite>自定义一个聊天窗口</cite></a></li>
  <li><a href="#setChatMin"><cite>初始最小化聊天界面</cite></a></li>
  <li><a href="#addList"><cite>添加好友/群到主面板</cite></a></li>
  <li><a href="#removeList"><cite>移除主面板的好友/群</cite></a></li>
  <li><a href="#getList"><cite>获取列表元素</cite></a></li>
  <li><a href="#cache"><cite>获取cache数据</cite></a></li>
  <li><a href="#ignore"><cite>无需接口的功能</cite></a></li>
  <li><a href="#copyright"><cite>关于版权</cite></a></li>
</ul>
<div class="layui-main site-inline">
  <div class="site-tree">
  <ul class="layui-tree">
  
    <li><h2>基础说明</h2></li>
  
    <li class="site-tree-noicon ">
      <a href="../index.htm" ><cite>开始使用</cite></a>
    </li>
    <li class="site-tree-noicon ">
      <a href="../base/infrastructure.html" >
        <cite>底层支撑</cite>
      </a>
    </li>
    <li class="site-tree-noicon ">
      <a href="../base/element.html" >
        <cite>页面元素</cite>
        <em>规范 / 公共类、属性</em>
      </a>
    </li>
    <li class="site-tree-noicon ">
      <a href="../base/modules.html" >
        <cite>组件规范</cite>
        <em>使用 / 模块扩展</em>
      </a>
    </li>
    <li class="site-tree-noicon ">
      <a href="../base/faq.html">
        <cite>常见问题</cite>
      </a>
    </li>
    
    <li><h2>页面元素</h2></li>
    
    
    
    <li class="site-tree-noicon ">
      <a href="../element/color.html">
        <cite>颜色</cite>
        <em>内置的色值参考</em>
      </a>
    </li>
    
    <li class="site-tree-noicon ">
      <a href="../element/icon.html">
        <cite>图标</cite>
        <em>字体图标</em>
      </a>
    </li>
    <li class="site-tree-noicon ">
      <a href="../element/auxiliar.html">
        <cite>辅助</cite>
        <em>引用 / 分块 / 横线…</em>
      </a>
    </li>
    <li class="site-tree-noicon ">
      <a href="../element/button.html" >
        <cite>按钮</cite>
        <em>button组</em>
      </a>
    </li>
    <li class="site-tree-noicon ">
      <a href="../element/form.html">
        <cite>表单</cite>
        <em>form元素集合</em>
      </a>
    </li>
    <li class="site-tree-noicon ">
      <a href="../element/nav.html">
        <cite>导航</cite>
        <em>菜单 / Tab / 面包屑 …</em>
      </a>
    </li>
    <li class="site-tree-noicon ">
      <a href="../element/table.html">
        <cite>表格</cite>
        <em>table - v1.0.5 新增</em>
      </a>
    </li>
   
    
    <li><h2>内置组件</h2></li>
    
    <li >
      <a href="layer.html">
        <i class="layui-icon" style="top: 3px;">&#xe638;</i><cite>弹出层</cite>
        <em>layer</em>
      </a>
    </li>
    <li class="layui-this">
      <a href="layim.html">
        <i class="layui-icon" style="position: relative; top: 3px;">&#xe63a;</i>
        <cite>即时通讯</cite>
        <em>layim</em>
      </a>
    </li>
    <li >
      <a href="laydate.html">
        <i class="layui-icon" style="top: 1px;">&#xe637;</i><cite>日期时间选择</cite>
        <em>laydate</em>
      </a>
    </li>
    <li >
      <a href="laypage.html">
        <i class="layui-icon">&#xe633;</i><cite>分页</cite>
        <em>laypage</em>
      </a>
    </li>
    <li >
      <a href="laytpl.html">
        <i class="layui-icon">&#xe628;</i><cite>模板引擎</cite>
        <em>laytpl</em>
      </a>
    </li>
    <li >
      <a href="layedit.html">
        <i class="layui-icon">&#xe639;</i>
        <cite>富文本编辑器</cite>
        <em>layedit</em>
      </a>
    </li>
    <li >
      <a href="form.html">
        <i class="layui-icon" style="top: 2px;">&#xe63c;</i>
        <cite>表单</cite>
        <em>form</em>
      </a>
    </li>
    <li >
      <a href="upload.html">
        <i class="layui-icon">&#xe62f;</i>
        <cite>文件上传</cite>
        <em>upload</em>
      </a>
    </li>
    <li >
      <a href="element.html">
        <i class="layui-icon" style="top: 1px; font-size: 18px;">&#xe62a;</i>
        <cite>常用元素操作</cite>
        <em>element</em>
      </a>
    </li>
    <li >
      <a href="tree.html">
        <i class="layui-icon">&#xe62e;</i>
        <cite>树形菜单</cite>
        <em>tree</em>
      </a>
    </li>
    
    <li >
      <a href="util.html">
        <i class="layui-icon">&#xe631;</i>
        <cite>工具块</cite>
        <em>util</em>
      </a>
    </li>
    <li >
      <a href="flow.html">
        <i class="layui-icon">&#xe636;</i>
        <cite>流加载</cite>
        <em>flow</em>
      </a>
    </li>
    <li >
      <a href="code.html">
        <i class="layui-icon" style="top: 1px;">&#xe635;</i>
        <cite>代码修饰器</cite>
        <em>code</em>
      </a>
    </li>
  </ul>
</div>

  <div class="site-content">
    <h1 class="site-h1"><i class="layui-icon">&#xe63a;</i>LayIM 2.x 开发者文档</h1>
    
    <div>
      <p style="margin-bottom: 15px;">当前文档适用于 <em>LayIM 2.x</em>，如果你正在了解的并非该版本，你可以前往其它版本阅览：<a href="layim.html" class="layui-btn">3.x文档</a>
    </div>
    
    <div class="site-tips site-text">
      <p>在WebIM似乎已被打入冷宫的今天，LayIM正试图重新为网页带来一些社交想象。作为一款Web即时通讯前端解决方案（服务端需自写），LayIM提供了全方位接口支撑，竭力以最灵便的方式接入到你的实际项目中。并始终坚持极简的体验，拉近你的用户在web间的距离。我们也将推出LayIM在Node.js端的集成方案，以供服务端层面的参考。
      <br><br>
      LayIM<em>兼容除IE6/7以外的所有浏览器</em>，如果你的网站仍需兼容ie6/7，那么强烈建议你说服你的老板或者客户。</p>
    </div>
    
    <div class="site-tips site-text">
      <p>模块加载名称：<a>layim</a>，官网地址：<a href="../../../layim.layui.com/index.htm"  target="_blank">layim.layui.com</a></p>
    </div>
    
<div style="margin: 15px 0; text-align: center; background-color: #F2F2F2;">
  <ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-6111334333458862" data-ad-slot="9841027833"></ins>
</div>

    
    <div class="site-title">
      <a name="start"></a>
      <fieldset><legend>开始使用</legend></fieldset>
    </div>
    <div class="site-text">
      <p>LayIM基于layui模块体系，因此你获得的其实是一个包含LayIM的layui框架，不同的是，开源版的layui并不包含LayIM。捐赠后，将您获得的压缩包解压，将layui整个目录文件放入你的项目后，不用再对其代码做任何修改（方便下次升级）。然后您只需引入下述两个文件即可。</p>
      <pre class="layui-code">
./layui/css/layui.css
./layui/layui.js</pre>
      <p><br>假如你将layui放入你的/static/目录中，并且你的html页面在根目录，那么一个最直接的例子是：</p>
      <pre class="layui-code">
&lt;!doctype html>
&lt;html>
&lt;head>
&lt;meta charset="utf-8">
&lt;title>LayIM测试&lt;/title>
&lt;link rel="stylesheet" href="layui.css" media="all">
&lt;/head>
&lt;body>
&lt;script src="layui.js">&lt;/script>
&lt;script>
layui.use('layim', function(layim){
  //先来个客服模式压压精
  layim.config({
    brief: true //是否简约模式（如果true则不显示主面板）
  }).chat({
    name: '客服姐姐'
    ,type: 'kefu'
    ,avatar: 'http://tp1.sinaimg.cn/5619439268/180/40030060651/1'
    ,id: -2
  });
});
&lt;/script>
&lt;/body>
&lt;/html>
      </pre>
      <p>通过上述方式，便可成功加载layim。当然，你仅仅只是看到了一个"客服姐姐"的聊天面板，这等同于：Hello World!
        <br>向“客服姐姐”问好后就忘了它吧，这份文档才刚刚开始。<img src="../../../res.layui.com/layui/src/images/face/2.gif" >
      </p>
    </div>
    
    <div class="site-title">
      <a name="config"></a>
      <fieldset><legend>初始化配置</legend></fieldset>
    </div>
    <div class="site-text">
      <p>一个你必须认识的方法：<a>layim.config(options)</a><br>控制着许多重要的配置，基本上一个完整LayIM实例的构成由它而开始，它允许你自由设定以下参数：</p>
      <pre class="layui-code">
layui.use('layim', function(layim){
  //基础配置
  layim.config({
  
    //获取主面板列表信息
    init: {
      url: '' //接口地址（返回的数据格式见下文）
      ,type: 'get' //默认get，一般可不填
      ,data: {} //额外参数
    }
    
    //配置我的信息（如果设定了该参数，则优先读取该参数，如果没有，这读取init返回的mine信息）
    ,mine: {
      "username": "LayIM体验者" //我的昵称
      ,"id": "100000123" //我的ID
      ,"status": "online" //在线状态 online：在线、hide：隐身
      ,"sign": "在深邃的编码世界，做一枚轻盈的纸飞机" //我的签名
      ,"avatar": "a.jpg" //我的头像
    }
    //获取群员接口
    ,members: {
      url: '' //接口地址（返回的数据格式见下文）
      ,type: 'get' //默认get，一般可不填
      ,data: {} //额外参数
    }
    
    //上传图片接口（返回的数据格式见下文）
    ,uploadImage: {
      url: '' //接口地址（返回的数据格式见下文）
      ,type: 'post' //默认post
    } 
    
    //上传文件接口（返回的数据格式见下文）
    ,uploadFile: {
      url: '' //接口地址（返回的数据格式见下文）
      ,type: 'post' //默认post
    } 
    
    //增加皮肤选择，如果不想增加，可以剔除该项
    ,skin: [ 
      'http://xxx.com/skin.jpg', 
      …
    ] 
    
    ,brief: false //是否简约模式（默认false，如果只用到在线客服，且不想显示主面板，可以设置 true）
    ,title: '我的LayIM' //主面板最小化后显示的名称
    ,min: false //用于设定主面板是否在页面打开时，始终最小化展现。默认false，即记录上次展开状态。
    ,minRight: null //【默认不开启】用户控制聊天面板最小化时、及新消息提示层的相对right的px坐标，如：minRight: '200px'
    ,maxLength: 3000 //最长发送的字符长度，默认3000
    ,isfriend: true //是否开启好友（默认true，即开启）
    ,isgroup: true //是否开启群组（默认true，即开启）
    ,right: '0px' //默认0px，用于设定主面板右偏移量。该参数可避免遮盖你页面右下角已经的bar。
    ,chatLog: '/chat/log/' //聊天记录地址（如果未填则不显示）
    ,find: '/find/' //查找好友/群的地址（如果未填则不显示）
    ,copyright: false //是否授权，如果通过官网捐赠获得LayIM，此处可填true
  });
});      
      </pre>
      <p>上面的参数中，brief、skin、min、isgroup、chatLog、copyright等参数都是非必填项，本身具有默认值。而对于<a>init</a>（初始化接口）、<a>members</a>（查看群员接口）、<a>uploadImage</a>（上传图片接口）、<a>uploadFile</a>（上传文件接口）所返回的数据格式，下面将逐一展示</p>
    </div>
    
    <div class="site-title">
      <a name="init"></a>
      <fieldset><legend>init数据格式</legend></fieldset>
    </div>
    <div class="site-text">
      <p>通过layim.config来设定init参数可获得我的信息、好友列表、群组列表，假设你进行了下述配置</p>
      <pre class="layui-code">
init: {
  url: '/api/im/getList/'
}    
      </pre>
      <p>那么该接口所返回的信息（response）应该严格按照下述的JSON格式：</p>
      <pre class="layui-code"  lay-skin="notepad">
{
  "code": 0 //0表示成功，其它表示失败
  ,"msg": "" //失败信息
  ,"data": {
  
    //我的信息（如果layim.config已经配置了mine，则该返回的信息无效）
    "mine": {
      "username": "纸飞机" //我的昵称
      ,"id": "100000" //我的ID
      ,"status": "online" //在线状态 online：在线、hide：隐身
      ,"sign": "在深邃的编码世界，做一枚轻盈的纸飞机" //我的签名
      ,"avatar": "a.jpg" //我的头像
    }
    
    //好友列表
    ,"friend": [{
      "groupname": "前端码屌" //好友分组名
      ,"id": 1 //分组ID
      ,"online": 2 //在线数量，可以不传
      ,"list": [{ //分组下的好友列表
        "username": "贤心" //好友昵称
        ,"id": "100001" //好友ID
        ,"avatar": "a.jpg" //好友头像
        ,"sign": "这些都是测试数据，实际使用请严格按照该格式返回" //好友签名
      }, …… ]
    }, …… ]
    
    //群组列表
    ,"group": [{
      "groupname": "前端群" //群组名
      ,"id": "101" //群组ID
      ,"avatar": "a.jpg" //群组头像
    }, …… ]
  }
}
      </pre>
      <p>Demo：<a href="../../../layim.layui.com/json/getList.json"  target="_blank">getList.json</a></p>
    </div>
    
    <div class="site-title">
      <a name="members"></a>
      <fieldset><legend>members数据格式</legend></fieldset>
    </div>
    <div class="site-text">
      <p>通过layim.config来设定members参数可获取群员列表，假设你进行了下述配置</p>
      <pre class="layui-code">
,members: {
  url: ' '/api/im/getMembers/'
  ,data: {}
}     
      </pre>
      </p>那么当点击群聊面板查看成员时，将会向members的url发送Ajax请求，并自动传递一个id参数（群组id）。该接口所返回的信息（response）应该严格按照下述的JSON格式：</p>
      <pre class="layui-code"  lay-skin="notepad">
{
  "code": 0 //0表示成功，其它表示失败
  ,"msg": "" //失败信息
  ,"data": {
    "owner": { 
      "username": "贤心" //群主昵称
      ,"id": "100001" //群主ID
      ,"avatar": "http://tp1.sinaimg.cn/1571889140/180/40030060651/1" //群主头像
      ,"sign": "这些都是测试数据，实际使用请严格按照该格式返回" //群主签名
    }
    ,"list": [{
      "username": "马小云" //群员昵称
      ,"id": "168168" //群员id
      ,"avatar": "http://tp4.sinaimg.cn/2145291155/180/5601307179/1" //群员头像
      ,"sign": "让天下没有难写的代码" //群员签名
    }, …… ]
  }
}      
      </pre>
      <p>Demo：<a href="../../../layim.layui.com/json/getMembers.json"  target="_blank">getMembers.json</a></p>
    </div>
    
    <div class="site-title">
      <a name="uploadImage"></a>
      <fieldset><legend>uploadImage数据格式</legend></fieldset>
    </div>
    <div class="site-text">
      <p>通过layim.config来设定uploadImage参数可进行图片上传，假设你进行了下述配置</p>
      <pre class="layui-code">
,uploadImage: {
  url: ''
}     
      </pre>
      </p>那么当点击聊天面板上传图片时，将会向uploadImage的url发送HTTP请求，进行图片上传。我们会给你传递一个name="file"的文件表单域，你接受即可。该接口所返回的信息（response）应该严格按照下述的JSON格式：</p>
      <pre class="layui-code" lay-skin="notepad">
{
  "code": 0 //0表示成功，其它表示失败
  ,"msg": "" //失败信息
  ,"data": {
    "src": "http://cdn.xxx.com/upload/images/a.jpg" //图片url
  }
}      
      </pre>
    </div>
    
    <div class="site-title">
      <a name="uploadFile"></a>
      <fieldset><legend>uploadFile数据格式</legend></fieldset>
    </div>
    <div class="site-text">
      <p>通过layim.config来设定uploadImage参数可进行文件上传，事实上跟图片上传非常类似有木有？假设你进行了下述配置</p>
      <pre class="layui-code">
,uploadFile: {
  url: ' ''
}     
      </pre>
      </p>那么当点击聊天面板上传文件时，将会向uploadFile的url发送HTTP请求，进行文件上传。我们会给你传递一个name="file"的文件表单域，你接受即可。该接口所返回的信息（response）应该严格按照下述的JSON格式：</p>
      <pre class="layui-code" lay-skin="notepad">
{
  "code": 0 //0表示成功，其它表示失败
  ,"msg": "" //失败信息
  ,"data": {
    "src": "http://cdn.xxx.com/upload/file/LayIM.zip" //文件url
    ,"name": 'LayIM.zip' //文件名
  }
}      
      </pre>
    </div>
    
    <div class="site-title">
      <a name="WebSocket"></a>
      <fieldset><legend>接入WebSocket</legend></fieldset>
    </div>
    <div class="site-text">
      <p>万万不可畏惧它的存在，除非你真的想用Ajax轮询去解决消息I/O。WebSocket会使得你的消息接受和传递变得极其轻松，最重要的一点是，性能卓绝。WebSocket的建立非常简单：</p>
      <pre class="layui-code" lay-skin="notepad">
layui.use('layim', function(layim){
  
  //建立WebSocket通讯
  //注意：也可以直接采用 socket.io的版本，下面是以原生WS为例
  
  var socket = new WebSocket('ws://localhost:8090');
  
  //发送一个消息
  socket.send('Hi Server, I am LayIM!');
<pre class="layui-code" lay-skin="notepad">
//更多情况下，一般是传递一个JSON
socket.send(JSON.stringify({
  type: '' //随便定义，用于在服务端区分消息类型
  ,data: {}
})); 
</pre>
  //连接成功时触发
  socket.onopen = function(){
    socket.send('XXX连接成功'); 
  };
  
  //监听收到的消息
  socket.onmessage = function(res){
    //res为接受到的值，如 {"emit": "messageName", "data": {}}
    //emit即为发出的事件名，用于区分不同的消息
  };
  
  另外还有onclose、onerror，分别是在链接关闭和出错时触发。
  
  //基本上常用的就上面几个了，是不是非一般的简单？<img src="../../../res.layui.com/layui/src/images/face/20.gif" >
  
  
});
      </pre>
      <p>服务端层面，不用害怕，事情也远没有那么复杂。我们会抽空给出Node.js的官方集成案例。但对于其它服务端语言，以下已经成功接入LayIM的案例对你也许会有一定帮助：</p>
      <pre style="line-height: 26px;" lay-skin="notepad">
Java：<a href="../../../fly.layui.com/jie/3229.html"  target="_blank">LayIM接入案例Java篇，含源码+图文</a>
.NET：<a href="../../../fly.layui.com/jie/3186.html"  target="_blank">LayIM接入案例.NET篇，含源码和Gif</a>
PHP：<a href="../../../fly.layui.com/jie/3235.html"  target="_blank">LayIM接入案例PHP篇 源码+Demo</a>，强烈建议采用 <a href="../../../www.workerman.net/index.htm"  target="_blank">Workerman</a>
Python：等Python案例分享，暂时可阅读 <a href="../../../www.jb51.net/article/51516.htm"  res="nofollow" target="_blank">http://www.jb51.net/article/51516.htm</a></pre>
      <p>你的服务端语言没有列举在上面？额。。。那一定是你的语言太冷门了，自己去网搜资料吧。</p>
    </div>
    
    <div class="site-title">
      <a name="log"></a>
      <fieldset><legend>查看更多聊天记录</legend></fieldset>
    </div>
    <div class="site-text">
      <p>为了避免联调的复杂性，我们并不内置更多聊天记录的展示。而是弹出一个聊天记录的layer窗口，这意味着你可以随意发挥聊天记录的页面。通过layim.config配置<a>chatLog</a>来指向聊天记录的URL。假设你进行了下述设定：</p>
      <pre class="layui-code">
layim.config({
  chatLog: '/chat/log/' //聊天记录地址，如果未填， 则不在聊天面板显示该icon
});      
      </pre>
      <p>那么，我们会在chatLog所对应的URL后面动态追加当前聊天窗口的ID（即好友或群组ID）和类型，如：/chat/log?id=123&type=friend
      <br><br>请注意：当你自建一个更多聊天记录的动态页面时，我们建议您通过Ajax来获取聊天记录，因为LayIM发送的内容，可能包含链接、图片等多媒体信息，它们需要 <a>parent.layui.layim.content(content)</a>方法来解析
      </p>
    </div>
    
    <div class="site-title">
      <a name="find"></a>
      <fieldset><legend>查找好友/群</legend></fieldset>
    </div>
    <div class="site-text">
      <p>同样为了避免联调的复杂性，我们并不内置查找好友/群功能。而是弹出一个layer窗口，这意味着你可以随意发挥该查找页面。通过layim.config配置<a>find</a>来指向查找的页面URL。如：</p>
      <pre class="layui-code">
layim.config({
  find: '/find/all/' //查找好友/群地址。如果未填，不不在主面板显示该icon
});      
      </pre>
    </div>
    
    <div class="site-title">
      <a name="on"></a>
      <fieldset><legend>事件监听</legend></fieldset>
    </div>
    <div class="site-text">
      <p>方法：<a>layim.on(event, callback)</a><br>用于LayIM事件监听。接受两个参数。第一个参数event即事件名，第二个参数callback即事件回调。</p>
    </div>
    
    <div class="site-title">
      <a name="onready"></a>
      <fieldset><legend>ready事件</legend></fieldset>
    </div>
    <div class="site-text">
      <p>事件名：<a>ready</a>，用于监听LayIM初始化就绪。由于主面板的渲染，需建立在init接口请求完毕的基础上，而一些操作必须等到主面板渲染完毕后才能操作，所以这个时候就可以放入ready事件的回调体中来执行。其回调接受一个object类型的参数，携带一些基础配置信息、我的用户信息、好友/群列表信息、本地数据库信息等，调用方式：</p>
      <pre class="layui-code">
layim.on('ready', function(options){
  console.log(options);
  //do something
});
//注意：简约模式（即brief: true时）不会触发该事件
      </pre>
    </div>
    
    <div class="site-title">
      <a name="ononline"></a>
      <fieldset><legend>监听在线状态切换</legend></fieldset>
    </div>
    <div class="site-text">
      <p>事件名：<a>online</a>，看到主面板你的昵称后的icon么，没错，就是它。当前支持“在线”、“隐身”两种状态切换。分别以online和hide的string类型的值传递给回调参数。如：</p>
      <pre class="layui-code">
layim.on('online', function(status){
  console.log(status); //获得online或者hide
  
  //此时，你就可以通过Ajax将这个状态值记录到数据库中了。
  //服务端接口需自写。
});     
      </pre>
    </div>
    
    <div class="site-title">
      <a name="onsendMessage"></a>
      <fieldset><legend>监听发送的消息</legend></fieldset>
    </div>
    <div class="site-text">
      <p>事件名：<a>sendMessage</a>，每当你发送一个消息，都可以通过该事件监听到。回调参数接受一个object类型的值，携带发送的聊天信息。如：</p>
      <pre class="layui-code">
layim.on('sendMessage', function(res){
  var mine = res.mine; //包含我发送的消息及我的信息
<pre class="layui-code">//mine的结构如下：
{
  avatar: "avatar.jpg" //我的头像
  ,content: "你好吗" //消息内容
  ,id: "100000" //我的id
  ,mine: true //是否我发送的消息
  ,username: "纸飞机" //我的昵称
}</pre>
  var to = res.to; //对方的信息
<pre class="layui-code">//to的结构如下：
{
  avatar: "avatar.jpg"
  ,id: "100001"
  ,name: "贤心"
  ,sign: "这些都是测试数据，实际使用请严格按照该格式返回"
  ,type: "friend" //聊天类型，一般分friend和group两种，group即群聊
  ,username: "贤心"
}</pre>
  //监听到上述消息后，就可以轻松地发送socket了，如：
  socket.send({
    type: 'chatMessage' //随便定义，用于在服务端区分消息类型
    ,data: res
  }); 
  
});
      </pre>
    </div>
    
    <div class="site-title">
      <a name="ongetMessage"></a>
      <fieldset><legend>监听接受的消息</legend></fieldset>
    </div>
    <div class="site-text">
      <p>事件的监听并非layim提供，而是WebSocket提供。<br>检测到WebSocket事件后，执行layim的内置方法：<a>layim.getMessage(options)</a> <br>即可显示消息到聊天面板（如果消息所指定的聊天面板没有打开，则会进入本地的消息队列中，直到指定的聊天面板被打开，方可显示。），这是一个对你有用的例子：</p>
      <pre class="layui-code">
//监听收到的聊天消息，假设你服务端emit的事件名为：chatMessage
socket.onmessage = function(res){
  if(res.emit === 'chatMessage'){
    layim.getMessage(res.data); //res.data即你发送消息传递的数据（阅读：<a href="#onsendMessage">监听发送的消息</a>）
  }
};
//它必须接受以下字段
<pre class="layui-code">
layim.getMessage({
  username: "纸飞机" //消息来源用户名
  ,avatar: "http://tp1.sinaimg.cn/1571889140/180/40030060651/1" //消息来源用户头像
  ,id: "100000" //聊天窗口来源ID（如果是私聊，则是用户id，如果是群聊，则是群组id）
  ,type: "friend" //聊天窗口来源类型，从发送消息传递的to里面获取
  ,content: "嗨，你好！本消息系离线消息。" //消息内容
  ,mine: false //是否我发送的消息，如果为true，则会显示在右方
  ,timestamp: 1467475443306 //服务端动态时间戳
});
</pre></pre>
    </div>
    
    <div class="site-title">
      <a name="onmembers"></a>
      <fieldset><legend>监听查看群员</legend></fieldset>
    </div>
    <div class="site-text">
      <p>事件名：<a>members</a>，在群聊面板中查看全部成员时触发，该事件返回获取群员接口（即layim.config中的members）的response信息。</p>
      <pre class="layui-code">
layim.on('members', function(data){
  console.log(data);
});
      </pre>
    </div>
    
    <div class="site-title">
      <a name="onchatChange"></a>
      <fieldset><legend>监听聊天窗口的切换</legend></fieldset>
    </div>
    <div class="site-text">
      <p>事件名：<a>chatChange</a>，坦白而言，似乎没什么卵用。不过有总比没有好。该事件返回一个object类型的参数，携带当前聊天面板的容器、基础信息等。</p>
      <pre class="layui-code">
layim.on('chatChange', function(data){
  console.log(data);
});
      </pre>
    </div>
    
    <div class="site-title">
      <a name="chat"></a>
      <fieldset><legend>自定义一个聊天窗口</legend></fieldset>
    </div>
    <div class="site-text">
      <p>方法名：<a>layim.chat(options)</a>，是否似曾相识，没错，我们见过文档最开始的“客服姐姐”用的就是该方法。它允许你自定义任意模式的聊天窗口，先看例子吧：</p>
      <p></p>
      <pre class="layui-code">
//自定义在线客服
<pre class="layui-code">
layim.config({
  brief: true //简约模式，不显示主面板
}).chat({
  name: '在线客服一' //名称
  ,type: 'kefu' //聊天类型
  ,avatar: 'http://tp1.sinaimg.cn/5619439268/180/40030060651/1' //头像
  ,id: -1 //定义唯一的id方便你处理信息
}).chat({
  name: '在线客服二' //名称
  ,type: 'kefu' //聊天类型
  ,avatar: 'http://tp1.sinaimg.cn/5619439268/180/40030060651/1' //头像
  ,id: -2 //定义唯一的id方便你处理信息
});
layim.setChatMin(); //收缩聊天面板
</pre>
//自定义群聊（对于想搞一个临时性的房间，貌似是挺有意思的）
<pre class="layui-code">
layim.chat({
  name: 'LayIM畅聊'
  ,type: 'group' //群组类型
  ,avatar: 'http://tp2.sinaimg.cn/5488749285/50/5719808192/1'
  ,id: 10000000 //定义唯一的id方便你处理信息
  ,members: 123 //成员数，不好获取的话，可以设置为0
});
</pre>
      </pre>
      <p>该方法结合brief: true（简约模式），可以免去较为复杂的数据配置。轻量地建立一个聊天面板。拥有较大的平台实用性。可以预见的是，它应该会成为LayIM一个露脸率最高的存在。想象一下吧，对你而言是否如此？</p>
    </div>
    
    <div class="site-title">
      <a name="setChatMin"></a>
      <fieldset><legend>初始最小化聊天界面</legend></fieldset>
    </div>
    <div class="site-text">
      <p>方法名：<a>layim.setChatMin()</a>，如果你在初始的状态下不想展开聊天面板（譬如<a>悬浮的在线客服</a>），那么该方法会派上用场，使用很简单，就不过多啰嗦了。</p>
      <pre class="layui-code">
layim.setChatMin();</pre>
    </div>
    
    <div class="site-title">
      <a name="addList"></a>
      <fieldset><legend>添加好友/群到主面板</legend></fieldset>
    </div>
    <div class="site-text">
      <p>方法名：<a>layim.addList(options)</a>，当你的WebSocket监听到有好友或者群新增时，需让LayIM的主面板同步添加的信息，可用该方法。先看看例子：</p>
      <pre class="layui-code">
layim.on('ready', function(res){
  
  
  //监听添加列表的socket事件，假设你服务端emit的事件名为：addList
  socket.onmessage = function(res){
    if(res.emit === 'addList'){
      layim.addList(res.data); //如果是在iframe页，如LayIM设定的add面板，则为 parent.layui.layim.addList(data);
    }
  };
  
  //需要特别注意的是回调返回的<a>res</a>
  
  //如果添加的是好友，res的结构必须是这样的
<pre class="layui-code">
{
  type: 'friend' //列表类型，只支持friend和group两种
  ,avatar: "a.jpg" //好友头像
  ,username: '冲田杏梨' //好友昵称
  ,groupid: 2 //所在的分组id
  ,id: "1233333312121212" //好友id
  ,sign: "本人冲田杏梨将结束AV女优的工作" //好友签名
}
</pre>
//如果添加的是群组，res的结构必须是这样的
<pre class="layui-code">
{
  type: 'group' //列表类型，只支持friend和group两种
  ,avatar: "a.jpg" //群组头像
  ,groupname: 'Angular开发' //群组名称
  ,id: "12333333" //群组id
}
</pre>
});
      </pre>
    </div>
    
    <div class="site-title">
      <a name="removeList"></a>
      <fieldset><legend>从主面板移除好友/群</legend></fieldset>
    </div>
    <div class="site-text">
      <p>方法名：<a>layim.removeList(options)</a>，当你的WebSocket监听到有好友或者群删除时，需让LayIM的主面板同步删除的信息，可用该方法。它的调用非常简单，只需要传两个key：</p>
      <pre class="layui-code">
layim.removeList({
  type: 'friend' //或者group
  ,id: 1238668 //好友或者群组ID
});
//如果是在iframe页，如LayIM设定的add面板，则为：
parent.layui.layim.removeList({
  type: 'friend' //或者group
  ,id: 1238668 //好友或者群组ID
});
      </pre>
    </div>
    <div class="site-title">
      <a name="getList"></a>
      <fieldset><legend>获取列表元素</legend></fieldset>
    </div>
    <div class="site-text">
      <p>LayIM的好友/群的列表所在元素，附带唯一的id，由固定前缀“layim-”+动态的type和id字符拼接而成，如<a>id="layim-friend10000"</a>，通过查找id选择器获得该元素后，你就可以对其进行头像置灰等处理了。</p>
    </div>
    
    <div class="site-title">
      <a name="cache"></a>
      <fieldset><legend>获取cache数据</legend></fieldset>
    </div>
    <div class="site-text">
      <p>方法名：<a>layim.cache()</a>，获取LayIM的cache信息，返回的信息结构和ready事件获得的信息一样，不同的是，改方法始终会获取到最新的cache。</p>
      <pre class="layui-code">
//输出的信息不妨在你的Chrome控制台看看（需在引有LayIM的页面中），在此就不做列举了
console.log(layim.cache()) </pre>
    </div>
    
    <div class="site-title">
      <a name="ignore"></a>
      <fieldset><legend>无需接口的功能</legend></fieldset>
    </div>
    <div class="site-text">
      <p>LayIM有许多功能是无需接口来处理的，在此特别列举几个比较常见的：</p>
      <p>
        <a>#历史会话</a>：LayIM会自动记录你每次打开的聊天窗口到本地数据库（localStorage）、所以这一块无需通过接口去渲染。<br>
        <a>#主面板的展开状态</a>、<a>#好友分组的展开状态</a>、<a>#皮肤的选择</a>：同样都会记录到本地数据库<br>
        <a>#搜索好友/群组</a>：LayIM内部会按照关键字检索出搜索结果。<br>
        <a>#消息提醒</a>：LayIM内置强大的消息提醒机制，你只需要监听消息，并获取消息，LayIM将为您处理好一切。<br>
        <a>#聊天记录</a>：LayIM为您的每个对话存储最新的50条记录到本地，当你下次打开时，仍然会初始化渲染这些内容。但我们仍然建议你的服务端也存储一份记录，因为“查看更多聊天记录”已经不再属于LayIM管辖<br>
        <a>#更多亮点</a>：潜藏在LayIM的每一处细节。
      </p>
    </div>
    
    <div class="site-title">
      <a name="copyright"></a>
      <fieldset><legend>关于版权</legend></fieldset>
    </div>
    <div class="site-text">
      <p>LayIM目前并非开源产品（以后也许会开源），因此如果你是通过捐赠渠道获得LayIM，可以通过layer.config设定copyright: true来剔除LayIM主面板的关于信息，这就表示你已经过授权。当然，如果你想友好地保留，我们也是非常欢迎的。如果你通过非捐赠渠道获得LayIM，我们并不会进行追究，<a>但是请勿进行销售，这是唯一的红线吧</a>。</p>
      <p>另外，再次强调一点：LayIM虽然并不开源，但layui是完全免费且开源的。LayIM是我们为数不多的接受收费的产品。因为一定资金的来源，是对我们整个开发流可持续发展的有力保障。仍然是那句话，如果你对LayIM的“收费”表示厌恶，请忽视它的存在。即便是没有一个人为LayIM买单，我们仍然会坚持初衷，即：<a>通过极简的体验，拉近你的用户在web间的距离。</a></p>
      <p>LayIM的作者是<a href="../../../sentsin.com/index.htm"  target="_blank">贤心</a>一人，版权最终解释权归他所有。</p>
    </div>
    
    <div class="layui-elem-quote">
  <p>Layui - 用心与你沟通</p>
</div>
    
  </div>
</div>
  
<div class="layui-footer footer footer-doc">
  <div class="layui-main">
    <p>2017 &copy; <a href="../../index.htm">layui.com</a> MIT license</p>
    <p>
      <a href="../../../fly.layui.com/jie/3147.html" target="_blank">捐赠作者</a>
      <!--<a href="javascript:layer.msg('暂无此页');">关于我们</a>-->
      <a href="mailto:xianxin@layui.com">合作联系</a>
      <a href="../../../github.com/sentsin/layui/index.htm" target="_blank">Git仓库</a>
      <a href="../../../fly.layui.com/jie/2461.html"  target="_blank">微信公众号</a>
    </p>
  </div>
</div>

<div class="site-tree-mobile layui-hide">
  <i class="layui-icon">&#xe602;</i>
</div>
<div class="site-mobile-shade"></div>
<script src="../../../layui/layui.js" charset="utf-8"></script>


</body>
</html>